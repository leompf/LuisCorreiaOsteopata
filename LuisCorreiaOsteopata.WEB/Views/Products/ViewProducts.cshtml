@model LuisCorreiaOsteopata.WEB.Models.PagedProductsViewModel

@{
    ViewData["Title"] = "Loja";
    Layout = "~/Views/Shared/_Layout2.cshtml";
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

@section MainMenu
{
    <partial name="_Menu"></partial>
}

@{
    int start = (Model.PageNumber - 1) * Model.PageSize + 1;
    int end = Math.Min(Model.PageNumber * Model.PageSize, Model.TotalProducts);
}

<!--Page Header Start-->
<section class="page-header">
    <div class="page-header__bg" style="background-image: url(~/assets/images/backgrounds/page-header-bg.jpg);">
    </div>
    <div class="container">
        <div class="page-header__inner">
            <h3>Produtos</h3>
            <div class="thm-breadcrumb__inner">
                <ul class="thm-breadcrumb list-unstyled">
                    <li><a asp-controller="Account" asp-action="Index">Home</a></li>
                    <li><span class="icon-arrow-left"></span></li>
                    <li>Produtos</li>
                </ul>
            </div>
        </div>
    </div>
</section>
<!--Page Header End-->
<!--Product Start-->
<section class="product">
    <div class="container">
        <div class="row">


            <div class="col-xl-9 col-lg-12">
                <div class="product__items">
                    <div class="row">
                        <div class="col-xl-12">
                            <div class="product__showing-result">
                                <div class="product__showing-text-box">
                                    <p class="product__showing-text">A mostrar @start–@end de @Model.TotalProducts resultados</p>
                                </div>

                                @* <div class="product__showing-sort">
                                    <div class="select-box">
                                        <select class="wide">
                                            <option data-display="Sort by popular">Sort by popular</option>
                                            <option value="1">Sort by popular</option>
                                            <option value="2">Sort by Price</option>
                                            <option value="3">Sort by Ratings</option>
                                        </select>
                                    </div>
                                </div> *@
                            </div>
                        </div>
                    </div>


                    <div class="product__all">
                        <div class="product__all-tab">
                            <div class="product__all-tab-button">
                                <ul class="tabs-button-box clearfix">
                                    <li data-tab="#grid" class="tab-btn-item active-btn-item">
                                        <div class="product__all-tab-button-icon one">
                                            <i class="fa fa-solid fa-bars"></i>
                                        </div>
                                    </li>
                                    <li data-tab="#list" class="tab-btn-item">
                                        <div class="product__all-tab-button-icon">
                                            <i class="fa fa-solid fa-list-ul"></i>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <!--Start Tabs Content Box-->
                            <div class="tabs-content-box">
                                <!--Start Tab-->
                                <div class="tab-content-box-item tab-content-box-item-active" id="grid">
                                    <div class="product__all-tab-content-box-item">
                                        <div class="product__all-tab-single">
                                            <div class="row">

                                                <!--Product All Single Start-->
                                                @foreach (var product in Model.Products)
                                                {
                                                    <div class="col-xl-4 col-lg-6 col-md-6">
                                                        <div class="single-product-style1">
                                                            <div class="single-product-style1__img">
                                                                <img src="@product.ImageFullPath" alt="@product.Name" />
                                                                <img src="@product.ImageFullPath" alt="@product.Name" />

                                                                @* Example: show discount or “New” badge dynamically *@
                                                                <ul class="single-product-style1__overlay">
                                                                    @if (product.LastPurchase.HasValue && (DateTime.Now - product.LastPurchase.Value).TotalDays < 30)
                                                                    {
                                                                        <li><p>Novo</p></li>
                                                                    }
                                                                    else if (product.Price < 30)
                                                                    {
                                                                        <li><p>5% Off</p></li>
                                                                    }
                                                                </ul>

                                                                <ul class="single-product-style1__info">
                                                                    @* <li>
                                                                        <a href="#" title="Add to Wishlist">
                                                                            <i class="fa fa-regular fa-heart"></i>
                                                                        </a>
                                                                    </li> *@
                                                                    <li>
                                                                        <form method="post" class="add-to-cart-form" asp-controller="Orders" asp-action="AddItemToCart" asp-route-id="@product.Id">
                                                                            <button type="submit" title="Add to Cart">
                                                                                <i class="fa fa-solid fa-cart-plus"></i>
                                                                            </button>
                                                                        </form>
                                                                    </li>
                                                                    <li>
                                                                        <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" title="Quick View">
                                                                            <i class="fa fa-regular fa-eye"></i>
                                                                        </a>
                                                                    </li>
                                                                    @* <li>
                                                                        <a href="#" title="Compare">
                                                                            <i class="fa fa-solid fa-repeat"></i>
                                                                        </a>
                                                                    </li> *@
                                                                </ul>
                                                            </div>

                                                            <div class="single-product-style1__content">
                                                                <div class="single-product-style1__content-left">
                                                                    <h4>
                                                                        <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id">
                                                                            @product.Name
                                                                        </a>
                                                                    </h4>
                                                                    <p>@product.Price.ToString("C2")</p>
                                                                </div>

                                                                @* <div class="single-product-style1__content-right">
                                                                    <div class="single-product-style1__review">
                                                                        <i class="fa fa-star"></i>
                                                                        <p>@((new Random().NextDouble() * 1 + 4).ToString("0.0"))</p>
                                                                    </div>
                                                                </div> *@
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="tab-content-box-item" id="list">
                                    <div class="product__all-tab-content-box-item">
                                        <div class="product__all-tab-single">
                                            <div class="row">
                                                @foreach (var product in Model.Products)
                                                {
                                                    <div class="col-xl-6 col-lg-6">
                                                        <div class="single-product-style2">
                                                            <div class="row">
                                                                <div class="col-xl-6 col-lg-6 col-md-6">
                                                                    <div class="single-product-style2__img">
                                                                        <img src="@product.ImageFullPath" alt="@product.Name" />
                                                                        <img src="@product.ImageFullPath" alt="@product.Name" />

                                                                        @* <ul class="single-product-style1__overlay">
                                                                            @if (product.IsAvailable)
                                                                            {
                                                                                <li><p>New</p></li>
                                                                            }
                                                                            else
                                                                            {
                                                                                <li><p>Sold Out</p></li>
                                                                            }
                                                                        </ul> *@
                                                                    </div>
                                                                </div>
                                                                <div class="col-xl-6 col-lg-6 col-md-6">
                                                                    <div class="single-product-style2__content">
                                                                        @* <div class="single-product-style2__review">
                                                                            <i class="fa fa-star"></i>
                                                                            <i class="fa fa-star"></i>
                                                                            <i class="fa fa-star"></i>
                                                                            <i class="fa fa-star"></i>
                                                                            <i class="fa fa-star"></i>
                                                                        </div> *@
                                                                        <div class="single-product-style2__text">
                                                                            <h4>
                                                                                <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id">
                                                                                    @product.Name
                                                                                </a>
                                                                            </h4>
                                                                            <p>@product.Price.ToString("C2")</p>
                                                                        </div>
                                                                        <ul class="single-product-style2__info">
                                                                            @*  <li>
                                                                                <a href="#" title="Add to Wishlist"><i class="fa fa-regular fa-heart"></i></a>
                                                                            </li> *@
                                                                            <li>
                                                                                <form method="post" class="add-to-cart-form" asp-controller="Orders" asp-action="AddItemToCart" asp-route-id="@product.Id">
                                                                                    <button type="submit" title="Add to Cart">
                                                                                        <i class="fa fa-solid fa-cart-plus"></i>
                                                                                    </button>
                                                                                </form>
                                                                            </li>
                                                                            <li>
                                                                                <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" title="Quick View">
                                                                                    <i class="fa fa-regular fa-eye"></i>
                                                                                </a>
                                                                            </li>
                                                                            @* <li>
                                                                                <a href="#" title="Compare"><i class="fa fa-solid fa-repeat"></i></a>
                                                                            </li> *@
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--End Tab-->

                        </div>
                        <!--End Tabs Content Box-->

                        <ul class="styled-pagination text-center clearfix list-unstyled">
                            @if (Model.PageNumber > 1)
                            {
                                <li class="arrow prev">
                                    <a asp-action="ViewProducts" asp-route-page="@(Model.PageNumber - 1)" asp-route-minPrice="@Model.MinPrice" asp-route-maxPrice="@Model.MaxPrice">
                                        <span class="icon-left-arrow"></span>
                                    </a>
                                </li>
                            }

                            @for (int i = 1; i <= Model.TotalPages; i++)
                            {
                                <li class="@(i == Model.PageNumber ? "active" : "")">
                                    <a asp-action="ViewProducts" asp-route-page="@i" asp-route-minPrice="@Model.MinPrice" asp-route-maxPrice="@Model.MaxPrice">@i</a>
                                </li>
                            }

                            @if (Model.PageNumber < Model.TotalPages)
                            {
                                <li class="arrow next">
                                    <a asp-action="ViewProducts" asp-route-page="@(Model.PageNumber + 1)" asp-route-minPrice="@Model.MinPrice" asp-route-maxPrice="@Model.MaxPrice">
                                        <span class="icon-right-arrow"></span>
                                    </a>
                                </li>
                            }
                        </ul>
                    </div>

                </div>
            </div>


            <div class="col-xl-3 col-lg-12">
                <div class="product__sidebar">
                    <div class="shop-search product__sidebar-single">
                        <form action="#">
                            <input type="text" name="searchTerm" placeholder="Pesquisar" value="@Model.SearchTerm">
                            <button type="submit"><i class="fa fa-search"></i></button>
                        </form>
                    </div>
                    <div class="product__price-ranger product__sidebar-single">
                        <h3 class="product__sidebar-title">Preço</h3>
                        <form method="get" asp-action="ViewProducts">
                            <div class="price-ranger">
                                <div id="slider-range"></div>
                                <div class="ranger-min-max-block">
                                    <input type="text" id="minPrice" name="minPrice" readonly class="min">
                                    <span>-</span>
                                    <input type="text" id="maxPrice" name="maxPrice" readonly class="max">
                                    <input type="submit" value="Filtrar">
                                </div>
                            </div>
                        </form>
                    </div>

                    <!--Start Products Style1 Single Sidear -->
                    <d@* iv class="shop-product-tags product__sidebar-single style">
                        <h3 class="product__sidebar-title">Reviews</h3>
                        <div class="sidebar-rating-box sidebar-rating-box--style2">
                            <ul>
                                <li>
                                    <input type="radio" id="fivestar" name="rating" checked="checked">
                                    <label for="fivestar">
                                        <i></i>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="fourstar" name="rating">
                                    <label for="fourstar">
                                        <i></i>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star gray"></span>
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="threestar" name="rating">
                                    <label for="threestar">
                                        <i></i>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star gray"></span>
                                        <span class="icon-star gray"></span>
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="twostar" name="rating">
                                    <label for="twostar">
                                        <i></i>
                                        <span class="icon-star"></span>
                                        <span class="icon-star"></span>
                                        <span class="icon-star gray"></span>
                                        <span class="icon-star gray"></span>
                                        <span class="icon-star gray"></span>
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="onestar" name="rating">
                                    <label for="onestar">
                                        <i></i>
                                        <span class="icon-star"></span>
                                        <span class="icon-star gray"></span>
                                        <span class="icon-star gray"></span>
                                        <span class="icon-star gray"></span>
                                        <span class="icon-star gray"></span>
                                    </label>
                                </li>
                            </ul>
                        </div>
                    </div> *@
                    <!--End Products Style1 Single Sidear -->
                </div>
            </div>
        </div>
    </div>
</section>
<!--Product End-->
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script type="text/javascript">
             document.querySelectorAll('.add-to-cart-form').forEach(form => {
            form.addEventListener('submit', async e => {
                e.preventDefault();

                const formData = new FormData(form);
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    updateCartCount();

                    Toastify({
                        text: "Item adicionado ao carrinho!",
                        duration: 5000,
                        gravity: "top",
                        position: "right",
                        backgroundColor: "#4BB543"
                    }).showToast();
                } else {
                    Toastify({
                        text: "Failed to add item to cart.",
                        backgroundColor: "#FF4B4B"
                    }).showToast();
                }
            });
        });
            $(function () {
            var min = 0;
            var max = 500; // adjust according to your product prices

            $("#slider-range").slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function (event, ui) {
                    $(".min").val(ui.values[0]);
                    $(".max").val(ui.values[1]);
                }
            });

            $(".min").val($("#slider-range").slider("values", 0));
            $(".max").val($("#slider-range").slider("values", 1));
        });
    </script>
}